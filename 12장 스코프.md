스코프란?
스코프란 유효범위를 의미한다.스코프는 변수 함수와 깊은 관련이 있다.
매변수는 함수 몸체 내부에서만 참조할수있다. 즉 매개변수의 유효범위는 함수 몸체 내부이다.
비순수 함수-함수내부의 상태(함수내부에서 선언한 변수또는 원시타입의 매개별수)만이 아니라 함수외부의 상태까지 변경하는 함수를 비순수함수라고 한다. 함수의 외부상태를 변경하면 상태 변화를 추적하기 어려워 진다.
따라서 함수의 외부상태를 변경하지 않는 순수함수를 지향한다.

변수는 코드의 가장 바깥영역에서 뿐아니라 코드블록이나 함수내에서도  선언할 수 있다. 이때 코드블록이나 함수는 중첩될수있다.

변수는 자신이 선언된 위치에 의해서 자신의 유효범위, 즉 다른 변수가 자신을 참조 할 수 있는 범위를 결정된다.
모든 식별자(변수이믊,함수이름,클래스이름 등)자신의 선언된 위치에 의해 다른 코드가 식별자 자신을 참조 할수있는 유효 범위가 결정되게 된다 이ㄹ를 스코프라고 한다.
즉 스코프는 식별자가 유효한 범위를 말한다. 자바스크립트 엔진이 식별자를 검색할때 사용하는 규칙이다.

환경-코드가 어디에서 실행되며,주변에 어떤 코드들이 있는지

 코드 문맥-은 환경으로 이루어져있다.
이를 구현한것이 실행컨택스트이며 모든 모드는 실행컨택스트에서 평가도거 실행된다.
스코프는 유효범위에 따라 동일한 식별자이름을 사용해도 충돌이 발생하지 않게 해주는 역할을 한다.스코프 내에서만은 식별자는 우일해야하지만 다른 스코프에서는 동이라한 이름의 식별자를 사용할 수있다.

var 키워드로 사용한 변수 선언을 같은 스코프내에서 중복선언이 허용된다.이는 의도치 않게 변수값이 변경되는 부작용을 발생시킨다.

let,const 키워드는 같은 스코프안에서 중복 선언이 되지 않는다.
2.스코프의 종류
전역과 지역으로 구분할 수있다. 

| 구분 | 설명                 | 스코프     | 변수     |
| ---- | -------------------- | ---------- | -------- |
| 전역 | 코드의 가장 바깥영역 | 전역스코프 | 정역변수 |
| 지역 | 함수 몸채 냐부       | 지역스코프 | 지역변수 |

이때 변수는 자신이 선언된 위치에 의해 자신의 유효한 범위인 스코프가 결정된다. 

전역에 변수를 선언하면 전역 스코프를 갖는 변수가 되고 이런 전역변수를 어디서든 참조가능하다.

 지역과 지역스코프- 지역은 함수 몸체를 말한다. 지역변수를 선언하면 지역스코프를 갖는 변수가 된다. 지역변수는 자신이 선언한 변수와 중첩 변수에서만 참조할수있다. 즉 자신의 지역스코프와 하위스코프에서만 유효하다.  자바스크립트 엔진이 스코프 체인 통해서 참조할 변수를 검색했기때문에 전역변수에 선언한 변수의 값과 함수 내부에 선언한 지역변수의 이름이 같다면 지역변수의 값을 참조한다.

스코프 체인
스코프함수의 중첩에 의해 계층적인 구조를 가진다. 중첩함수의 지역스코프는 중첩함수를 포함하는 외부 스코프와 계층적인 구조를 가진다. 외부스코프의 지역스코프는 중첩 스코프의 상위 스코프다.

모든 스코프는 계증적인 구조를 가지게 되며, 모든 스코프의 최산위 스코프는 전역 스코프다. 이렇게 스코프가 계층적으로 연결되는 것을 스코프 체인 이라고 부른다.
변수를 참조할때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하여 선언된 변수를 검색한다.
자바스크립트 엔진은 코드를 실행하기 앞서 위 그림과 유사한 데이터(렉시컬 환경)을 생성하고 변수의 할당이 일어나면 이 데이터의 값을 변경한다. 변수의 검색도 이 데이터 상에서 이루어진다.

렉시컬 환경- 스코프체인은 실행 컨택스트의 렉시컬 한경을 연결한 것이다.렉시컬 환경은 코드가 로드되고 곧바로 생성되고 함수의 렉시컬 환경은 함수가 호출되고 곧바로 생성된다.

스코프 체인에 의한 변수 검색
자바스크립트 엔진ㅇ은 스코프첸인을 다라 변수가 참조하는 코드의 스코프에서 상위 스코프 방향으로 이동하면서 변수르 검색한다. 절대로 하위 방향으로 내려가면서 식별자를 검색하는 일이 없다.

이는 상위 스코프에서 윻한 변수는 하위 스코프에서 자유롭게 참조할수있지만 하이 스코프에서 유효한 변수를 상위 스코프에서 참조할수없다.스코프 체인으로 연결된 스코프의 계층적인 구조는 부자관계로 상속과 유사하다. 상속을 통해 부모의 자산이 자유롭게 사용할 수있지만 부모는 자식의 재산을 사용할 수없다.


5.스코프 체인에 의한 함수 검색
 함수선언문으로 함수를 정의 하면 자바스크립트엔진에 의해 다른 코드가 실행되기 이전에 함수객체를 먼저 생성하고 함수이름고 동일한 이름의 변수를 암묵적으로 선언하고 생성된 객체에 할당한다.
함수도 변수에 할당되기 때문에 스코프를 가지게 된다.


6.함수레벨 스코프

지역은 함수 몸체 내부를 말하고 지역은 지역스코프를 만든다. 코드블록이 아닌 함수에 의해서만 지역스코프가 생성된다는 의미다.
var 키워드로 선언된 변수는 오로지 함수의 코드 블록만을 지역 스코프로 인정한다. 이러한 특성을 함수레벨 스코프라고 한다.

위에서 이야기 했듯이 함수 밖에서 선언한 변수는 모두 전역변수가 된다 이렇게 되면 중복되었을때 변수 값이 변경되는 부작용이 일어난다. var키워드는 블록레벨 스코프를 지원하기 때문에 함수 밖에서 선언된 변수가 코드블록내에서 선언 되었다고 할지라도 모두 전역변수이다.

var  키워드는 블록레벨스코프를 따르지 않는다. 따라서 코드블록안에서 선언했다할지라도 이는 지역변수가 아닌 전역변수이고 이는 의도치않은 재할당때문에 값이 변경되는 부작용이 발생한다.

7.렉시컬 스코프
실행결과에 대한 상위 스코프가 무엇에 따라 결정되는 지의 패턴
1.함수를 어디서 호출했는가에 따라 상위 스코프가 결정된다.(동적스코프)
2.함수를 어디서 정의 했는지에 따라 함수의 상위 스코프가 결정된다.
(렉시컬 스코 또는 정적 스코프)-동적 스코프처럼 사위 스코프가 동적으로 변하지않고 정의가 평가되는 시점에 상위 스코프가 정적으로 결정된다.

자바스크립트를 비롯한 대부분의 프로그래밍 언어는 렉시컬 스코프를 따른다. 따라서 함수를 어디서 호출했는지가 아니라 어디에서 정의했는지에 따라 상위 스코프가 결졍된다. 모든 함수정의는 평가되너 함수객체를 생성할때 자신이 정의된 스코프를 기억한다. 그리고 함수가 호출되면 언제나 자신이 기억하고있는 자신이 정위된 스코프를 상위 스코프로 사용한다.

함수 객체가 기억하고있는 것은 렉시컬 환경이다. 함수의 정의가 평가되어 함수객체를 생성할때 자신이 정의된 스코프,즉 렉시컬 환경을 생성한 함수 객체의 내부슬롯에 저장한다. 렉시컬 환경은 자바스크립트 엔진이 식별자와 스코프를 관리하기 위해 사용하는 일종의 자료구조로서 스코프를 구분하여 식별자를 등록하고 관리하는 저장소의 역할을 한다. 전역에 함수를 정의하면 전역코드가 실행되기 이전에 먼저 평가되어 함수객체를 생성한다 이때 생선된 함수객체는 자신이 정의된 스코프를 기억한다.그리고 함수가 호출되면 ㅗ출되는 곳이 어디인지가 관계없이 언제나 자신이 기억하는 전역 스코프를 상위 스코프로 사용한다.

8.암묵적 전역변수
선언하지 않은 변수에 값을 할당하면 자바스크립트엔진이 아무런 에러 없이 암묵젓으로 전역변수를 선언하고 값을 할당한다.

함수가 호출이되면 변수x에 값을 할당하기위해 자바스크립트엔진은 스코프체인을 따라서 함수의 스코프부터 변수x의선언을 찾는다. 함수 스코프에서 변수x선언을 찾을 수없으므로 사위 스코프,즉 전역 스코프에서 변수x를 찾는다. 전역스코프에서도 찾을 수없어서 참조에러를 발생시켜야 하지만 자바스크립트엔진이 이를 암묵적으로 전역변수x를 선언한다. 이러한 변수를 암묵적인 전역변수라한다.
하지만 이로인해서 의도하지 않게 전역변수가 생성되고 이로인해 인해서 전역변수가 중복선언될수있다.

자바스크립트는 파일마다 독립적인 파일 스코프를 가지고있지 않는다. 따라서 모듈화가 안된다. 하나의 파일로 통합된것처럼 동작한다.

따라서 전역 변수 i는 중복되고 나중에 선언된 변수 i의 값이 먼저 선언된 변수 i의 값을 덮어쓰게 된다. 자바스크립트는 변수의 중복 선언을 허용하므로 어떠한 에러도 발생하지 않고 무한 반복 상태에 빠지게 된다.












